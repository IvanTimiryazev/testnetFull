{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ivylou/Desktop/pythonProject/keysee/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/ivylou/Desktop/pythonProject/keysee/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/ivylou/Desktop/pythonProject/keysee/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useCallback,useState}from\"react\";import classes from\"./AuthForm.module.css\";import logoMain from\"../../images/LogoMain.png\";import useInput from\"../../hooks/use-input\";import{useHistory}from\"react-router-dom\";import{useDispatch,useSelector}from\"react-redux\";import{authActions}from\"../../store/auth\";import MainButton from\"../Reusable/MainButton\";import PasswordInput from\"../Reusable/PasswordInput\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LoginForm=function LoginForm(){var history=useHistory();var dispatch=useDispatch();var rememberMe=useSelector(function(state){return state.auth.rememberMe;});var isError=useSelector(function(state){return state.auth.error;});var _useState=useState(true),_useState2=_slicedToArray(_useState,2),checkBox=_useState2[0],setCheckBox=_useState2[1];var _useInput=useInput(function(value){return value.trim().length>=1;}),enteredEmail=_useInput.value,emailInputHasError=_useInput.hasError,enteredEmailIsValid=_useInput.isValid,emailChangedHandler=_useInput.valueChangeHandler,emailBlurHandler=_useInput.inputBlurHandler,emailFocusHandler=_useInput.inputFocusHandler,resetEmailInput=_useInput.reset;var _useInput2=useInput(function(value){return value.trim().length>=1;}),enteredPassword=_useInput2.value,passwordInputHasError=_useInput2.hasError,enteredPasswordIsValid=_useInput2.isValid,passwordChangedHandler=_useInput2.valueChangeHandler,passwordBlurHandler=_useInput2.inputBlurHandler,resetPasswordInput=_useInput2.reset;var checkBoxHandler=function checkBoxHandler(){setCheckBox(function(prev){return!prev;});dispatch(authActions.rememberMeHandler());};var formIsValid=false;if(enteredEmailIsValid&&enteredPasswordIsValid){formIsValid=true;}var logoutHandler=useCallback(function(){dispatch(authActions.logOut());},[dispatch]);var submitHandler=function submitHandler(event){event.preventDefault();var sendRequest=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"/api/v1/login\",{method:\"POST\",body:JSON.stringify({email:enteredEmail,password:enteredPassword}),headers:{\"Content-Type\":\"application/json\"}});case 2:response=_context.sent;if(response.ok){_context.next=5;break;}throw new Error(\"Email or password was wrong\");case 5:_context.next=7;return response.json();case 7:data=_context.sent;dispatch(authActions.logIn(data.access_token));if(!rememberMe){setTimeout(logoutHandler,7200000);}else if(rememberMe){setTimeout(logoutHandler,604800000);}case 10:case\"end\":return _context.stop();}}},_callee);}));return function sendRequest(){return _ref.apply(this,arguments);};}();// sendRequest().catch((err) => dispatch(authActions.showError(err.message)));\ntry{sendRequest();}catch(err){dispatch(authActions.showError(err.message));}document.activeElement.blur();resetEmailInput();resetPasswordInput();};var signInHandler=function signInHandler(){history.replace(\"/register\");dispatch(authActions.removeError());};var forgotPasswordHandle=function forgotPasswordHandle(){history.replace(\"/reset-password\");dispatch(authActions.removeError());};var checkBoxClasses=!checkBox?\"\".concat(classes.checkBox):\"\".concat(classes.checkBox,\" \").concat(classes.checkedBox);var emailInputClasses=emailInputHasError||isError?\"formInput wrongCredentials\":\"formInput\";return/*#__PURE__*/_jsxs(\"div\",{className:classes.container,children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,className:classes.loginForm,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Sign In\"}),/*#__PURE__*/_jsxs(\"div\",{className:classes.newUser,children:[/*#__PURE__*/_jsx(\"p\",{children:\"New user?\"}),/*#__PURE__*/_jsx(\"span\",{onClick:signInHandler,children:\"Sign up.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"inputsContainer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"email\",placeholder:\"Email\",className:emailInputClasses,value:enteredEmail,onChange:emailChangedHandler,onBlur:emailBlurHandler,onFocus:emailFocusHandler}),/*#__PURE__*/_jsx(PasswordInput,{inputType:\"password\",enteredPassword:enteredPassword,passwordInputHasError:passwordInputHasError,enteredPasswordIsValid:enteredPasswordIsValid,passwordChangedHandler:passwordChangedHandler,passwordBlurHandler:passwordBlurHandler,resetPasswordInput:resetPasswordInput,placeholder:\"Password\"})]}),isError&&/*#__PURE__*/_jsx(\"p\",{className:classes.errorText,children:isError.errorMessage}),!isError&&/*#__PURE__*/_jsxs(\"div\",{className:classes.stayLoggedIn,children:[/*#__PURE__*/_jsx(\"div\",{onClick:checkBoxHandler,className:checkBoxClasses}),/*#__PURE__*/_jsx(\"span\",{children:\"Remember me\"})]}),/*#__PURE__*/_jsx(MainButton,{title:\"Sign In\",type:\"submit\",disabled:!formIsValid})]}),/*#__PURE__*/_jsx(\"img\",{src:logoMain,alt:\"keysee\",className:classes.mainLogo})]});};export default LoginForm;","map":{"version":3,"names":["React","useCallback","useState","classes","logoMain","useInput","useHistory","useDispatch","useSelector","authActions","MainButton","PasswordInput","LoginForm","history","dispatch","rememberMe","state","auth","isError","error","checkBox","setCheckBox","value","trim","length","enteredEmail","emailInputHasError","hasError","enteredEmailIsValid","isValid","emailChangedHandler","valueChangeHandler","emailBlurHandler","inputBlurHandler","emailFocusHandler","inputFocusHandler","resetEmailInput","reset","enteredPassword","passwordInputHasError","enteredPasswordIsValid","passwordChangedHandler","passwordBlurHandler","resetPasswordInput","checkBoxHandler","prev","rememberMeHandler","formIsValid","logoutHandler","logOut","submitHandler","event","preventDefault","sendRequest","fetch","method","body","JSON","stringify","email","password","headers","response","ok","Error","json","data","logIn","access_token","setTimeout","err","showError","message","document","activeElement","blur","signInHandler","replace","removeError","forgotPasswordHandle","checkBoxClasses","checkedBox","emailInputClasses","container","loginForm","newUser","errorText","errorMessage","stayLoggedIn","mainLogo"],"sources":["/Users/ivylou/Desktop/pythonProject/keysee/src/components/Login/LoginForm.js"],"sourcesContent":["import React, { useCallback, useState } from \"react\";\n\nimport classes from \"./AuthForm.module.css\";\nimport logoMain from \"../../images/LogoMain.png\";\nimport useInput from \"../../hooks/use-input\";\nimport { useHistory } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { authActions } from \"../../store/auth\";\nimport MainButton from \"../Reusable/MainButton\";\nimport PasswordInput from \"../Reusable/PasswordInput\";\n\nconst LoginForm = () => {\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const rememberMe = useSelector((state) => state.auth.rememberMe);\n  const isError = useSelector((state) => state.auth.error);\n  const [checkBox, setCheckBox] = useState(true);\n\n  const {\n    value: enteredEmail,\n    hasError: emailInputHasError,\n    isValid: enteredEmailIsValid,\n    valueChangeHandler: emailChangedHandler,\n    inputBlurHandler: emailBlurHandler,\n    inputFocusHandler: emailFocusHandler,\n    reset: resetEmailInput,\n  } = useInput((value) => value.trim().length >= 1);\n\n  const {\n    value: enteredPassword,\n    hasError: passwordInputHasError,\n    isValid: enteredPasswordIsValid,\n    valueChangeHandler: passwordChangedHandler,\n    inputBlurHandler: passwordBlurHandler,\n    reset: resetPasswordInput,\n  } = useInput((value) => value.trim().length >= 1);\n\n  const checkBoxHandler = () => {\n    setCheckBox((prev) => !prev);\n    dispatch(authActions.rememberMeHandler());\n  };\n\n  let formIsValid = false;\n  if (enteredEmailIsValid && enteredPasswordIsValid) {\n    formIsValid = true;\n  }\n\n  const logoutHandler = useCallback(() => {\n    dispatch(authActions.logOut());\n  }, [dispatch]);\n\n  const submitHandler = (event) => {\n    event.preventDefault();\n\n    const sendRequest = async () => {\n      const response = await fetch(\"/api/v1/login\", {\n        method: \"POST\",\n        body: JSON.stringify({\n          email: enteredEmail,\n          password: enteredPassword,\n        }),\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Email or password was wrong\");\n      }\n\n      const data = await response.json();\n      dispatch(authActions.logIn(data.access_token));\n\n      if (!rememberMe) {\n        setTimeout(logoutHandler, 7200000);\n      } else if (rememberMe) {\n        setTimeout(logoutHandler, 604800000);\n      }\n    };\n\n    // sendRequest().catch((err) => dispatch(authActions.showError(err.message)));\n\n    try {\n      sendRequest();\n    } catch (err) {\n      dispatch(authActions.showError(err.message));\n    }\n\n    document.activeElement.blur();\n    resetEmailInput();\n    resetPasswordInput();\n  };\n\n  const signInHandler = () => {\n    history.replace(\"/register\");\n    dispatch(authActions.removeError());\n  };\n\n  const forgotPasswordHandle = () => {\n    history.replace(\"/reset-password\");\n    dispatch(authActions.removeError());\n  };\n\n  const checkBoxClasses = !checkBox\n    ? `${classes.checkBox}`\n    : `${classes.checkBox} ${classes.checkedBox}`;\n\n  const emailInputClasses =\n    emailInputHasError || isError ? `formInput wrongCredentials` : `formInput`;\n\n  return (\n    <div className={classes.container}>\n      <form onSubmit={submitHandler} className={classes.loginForm}>\n        <h1>Sign In</h1>\n        <div className={classes.newUser}>\n          <p>New user?</p>\n          <span onClick={signInHandler}>Sign up.</span>\n        </div>\n        <div className=\"inputsContainer\">\n          <input\n            type=\"email\"\n            placeholder=\"Email\"\n            className={emailInputClasses}\n            value={enteredEmail}\n            onChange={emailChangedHandler}\n            onBlur={emailBlurHandler}\n            onFocus={emailFocusHandler}\n          />\n          <PasswordInput\n            inputType=\"password\"\n            enteredPassword={enteredPassword}\n            passwordInputHasError={passwordInputHasError}\n            enteredPasswordIsValid={enteredPasswordIsValid}\n            passwordChangedHandler={passwordChangedHandler}\n            passwordBlurHandler={passwordBlurHandler}\n            resetPasswordInput={resetPasswordInput}\n            placeholder=\"Password\"\n          />\n        </div>\n        {isError && <p className={classes.errorText}>{isError.errorMessage}</p>}\n        {!isError && (\n          <div className={classes.stayLoggedIn}>\n            <div onClick={checkBoxHandler} className={checkBoxClasses}></div>\n            <span>Remember me</span>\n          </div>\n        )}\n        <MainButton title=\"Sign In\" type=\"submit\" disabled={!formIsValid} />\n        {/* <span onClick={forgotPasswordHandle} className={classes.forgotPassword}>\n          Forgot password?\n        </span> */}\n      </form>\n      <img src={logoMain} alt=\"keysee\" className={classes.mainLogo} />\n    </div>\n  );\n};\n\nexport default LoginForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}