{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dmitrykoptev/Documents/GitHub/keysee/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/dmitrykoptev/Documents/GitHub/keysee/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React from\"react\";import{useDispatch}from\"react-redux\";import useInput from\"../../../hooks/use-input\";import{authActions}from\"../../../store/auth\";import{modalActions}from\"../../../store/modals\";import{notificationActions}from\"../../../store/notification\";import MainButton from\"../../Reusable/MainButton\";import Modal from\"../../Reusable/Modal\";import PasswordInput from\"../../Reusable/PasswordInput\";import classes from\"./ChangePasswordModal.module.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ChangePasswordModal=function ChangePasswordModal(props){var dispatch=useDispatch();var _useInput=useInput(function(value){return value.trim().length>=6;}),enteredPasswordOld=_useInput.value,passwordInputHasErrorOld=_useInput.hasError,enteredPasswordIsValidOld=_useInput.isValid,passwordChangedHandlerOld=_useInput.valueChangeHandler,passwordBlurHandlerOld=_useInput.inputBlurHandler,resetPasswordInputOld=_useInput.reset;var _useInput2=useInput(function(value){return value.trim().length>=6;}),enteredPassword=_useInput2.value,passwordInputHasError=_useInput2.hasError,enteredPasswordIsValid=_useInput2.isValid,passwordChangedHandler=_useInput2.valueChangeHandler,passwordBlurHandler=_useInput2.inputBlurHandler,resetPasswordInput=_useInput2.reset;var _useInput3=useInput(function(value){return value.trim().length>=6;}),enteredPasswordRepeat=_useInput3.value,passwordInputHasErrorRepeat=_useInput3.hasError,enteredPasswordIsValidRepeat=_useInput3.isValid,passwordChangedHandlerRepeat=_useInput3.valueChangeHandler,passwordBlurHandlerRepeat=_useInput3.inputBlurHandler,resetPasswordInputRepeat=_useInput3.reset;var resetForm=function resetForm(){resetPasswordInputOld();resetPasswordInput();resetPasswordInputRepeat();};var validationError;if(passwordInputHasErrorOld||passwordInputHasError||passwordInputHasErrorRepeat){validationError=true;}var formIsValid=false;if(enteredPasswordIsValid&&enteredPassword===enteredPasswordRepeat){formIsValid=true;}// ПРИ РЕНДЕРЕ МОДАЛКИ ЗАПУСКАЕТСЯ ФУНКЦИЯ, КОТОРАЯ ЗАПРАШИВАЕТ ИЗ БД ТЕКУЩИЙ ПАРОЛЬ ПОЛЬЗОВАТЕЛЯ\n// И СОХРАНЯЕТ ЕГО В ПЕРЕМЕННОЙ\n// ЭТА ПЕРЕМЕННАЯ СРАВНИВАЕТСЯ С enteredPasswordOld И РЕЗУЛЬТАТ ЭТОГО СРАВНЕНИЯ СОХРАНЯЕТСЯ В ДРУГОЙ ПЕРЕМЕННОЙ\n// КОТОРАЯ В СВОЮ ОЧЕРЕДЬ ИСПОЛЬЗУЕТСЯ ПРИ ВАЛИДАЦИИ formIsValid\nvar submitHandler=function submitHandler(event){event.preventDefault();var sendRequest=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"api/v1/edit_password\",{method:\"PUT\",body:JSON.stringify({current_password:enteredPasswordOld,password:enteredPassword}),headers:{Authorization:\"Bearer \".concat(localStorage.getItem(\"token\")),\"Content-Type\":\"application/json\"}});case 2:response=_context.sent;document.activeElement.blur();resetPasswordInputOld();resetPasswordInput();resetPasswordInputRepeat();if(response.ok){_context.next=9;break;}throw new Error(\"Something went wrong. Please try again.\");case 9:console.log(enteredPassword);dispatch(modalActions.closeModal());dispatch(notificationActions.showNotification({status:\"success\",message:\"Your password has been changed successfully! \"}));setTimeout(function(){dispatch(notificationActions.hideNotification());// dispatch(authActions.logOut());\n},2500);setTimeout(function(){dispatch(notificationActions.resetNotification());},4000);case 14:case\"end\":return _context.stop();}}},_callee);}));return function sendRequest(){return _ref.apply(this,arguments);};}();sendRequest().catch(function(err){dispatch(notificationActions.showNotification({status:\"error\",message:err.message}));setTimeout(function(){dispatch(notificationActions.hideNotification());},2500);setTimeout(function(){dispatch(notificationActions.resetNotification());},4000);});};return/*#__PURE__*/_jsx(Modal,{modalType:\"changePassword\",reset:resetForm,show:props.show,children:/*#__PURE__*/_jsxs(\"div\",{className:classes.container,children:[/*#__PURE__*/_jsx(\"span\",{className:classes.title,children:\"Change password\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inputsContainer\",children:[/*#__PURE__*/_jsx(PasswordInput,{enteredPassword:enteredPasswordOld,passwordInputHasError:passwordInputHasErrorOld,enteredPasswordIsValid:enteredPasswordIsValidOld,passwordChangedHandler:passwordChangedHandlerOld,passwordBlurHandler:passwordBlurHandlerOld,resetPasswordInput:resetPasswordInputOld,placeholder:\"Old password\"}),/*#__PURE__*/_jsx(PasswordInput,{enteredPassword:enteredPassword,passwordInputHasError:passwordInputHasError,enteredPasswordIsValid:enteredPasswordIsValid,passwordChangedHandler:passwordChangedHandler,passwordBlurHandler:passwordBlurHandler,resetPasswordInput:resetPasswordInput,placeholder:\"New password\"}),/*#__PURE__*/_jsx(PasswordInput,{enteredPassword:enteredPasswordRepeat,passwordInputHasError:passwordInputHasErrorRepeat,enteredPasswordIsValid:enteredPasswordIsValidRepeat,passwordChangedHandler:passwordChangedHandlerRepeat,passwordBlurHandler:passwordBlurHandlerRepeat,resetPasswordInput:resetPasswordInputRepeat,placeholder:\"New password\"})]}),validationError&&/*#__PURE__*/_jsx(\"span\",{className:classes.errorText,children:\"Password can't be less then 6 symbols.\"}),/*#__PURE__*/_jsx(MainButton,{title:\"Confirm\",type:\"submit\",disabled:!formIsValid})]})]})});};export default ChangePasswordModal;","map":{"version":3,"names":["React","useDispatch","useInput","authActions","modalActions","notificationActions","MainButton","Modal","PasswordInput","classes","ChangePasswordModal","props","dispatch","value","trim","length","enteredPasswordOld","passwordInputHasErrorOld","hasError","enteredPasswordIsValidOld","isValid","passwordChangedHandlerOld","valueChangeHandler","passwordBlurHandlerOld","inputBlurHandler","resetPasswordInputOld","reset","enteredPassword","passwordInputHasError","enteredPasswordIsValid","passwordChangedHandler","passwordBlurHandler","resetPasswordInput","enteredPasswordRepeat","passwordInputHasErrorRepeat","enteredPasswordIsValidRepeat","passwordChangedHandlerRepeat","passwordBlurHandlerRepeat","resetPasswordInputRepeat","resetForm","validationError","formIsValid","submitHandler","event","preventDefault","sendRequest","fetch","method","body","JSON","stringify","current_password","password","headers","Authorization","localStorage","getItem","response","document","activeElement","blur","ok","Error","console","log","closeModal","showNotification","status","message","setTimeout","hideNotification","resetNotification","catch","err","show","container","title","errorText"],"sources":["/Users/dmitrykoptev/Documents/GitHub/keysee/src/components/Header/MenuModals/ChangePasswordModal.js"],"sourcesContent":["import React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport useInput from \"../../../hooks/use-input\";\nimport { authActions } from \"../../../store/auth\";\nimport { modalActions } from \"../../../store/modals\";\nimport { notificationActions } from \"../../../store/notification\";\nimport MainButton from \"../../Reusable/MainButton\";\nimport Modal from \"../../Reusable/Modal\";\nimport PasswordInput from \"../../Reusable/PasswordInput\";\n\nimport classes from \"./ChangePasswordModal.module.css\";\n\nconst ChangePasswordModal = (props) => {\n  const dispatch = useDispatch();\n\n  let {\n    value: enteredPasswordOld,\n    hasError: passwordInputHasErrorOld,\n    isValid: enteredPasswordIsValidOld,\n    valueChangeHandler: passwordChangedHandlerOld,\n    inputBlurHandler: passwordBlurHandlerOld,\n    reset: resetPasswordInputOld,\n  } = useInput((value) => value.trim().length >= 6);\n\n  let {\n    value: enteredPassword,\n    hasError: passwordInputHasError,\n    isValid: enteredPasswordIsValid,\n    valueChangeHandler: passwordChangedHandler,\n    inputBlurHandler: passwordBlurHandler,\n    reset: resetPasswordInput,\n  } = useInput((value) => value.trim().length >= 6);\n\n  let {\n    value: enteredPasswordRepeat,\n    hasError: passwordInputHasErrorRepeat,\n    isValid: enteredPasswordIsValidRepeat,\n    valueChangeHandler: passwordChangedHandlerRepeat,\n    inputBlurHandler: passwordBlurHandlerRepeat,\n    reset: resetPasswordInputRepeat,\n  } = useInput((value) => value.trim().length >= 6);\n\n  const resetForm = () => {\n    resetPasswordInputOld();\n    resetPasswordInput();\n    resetPasswordInputRepeat();\n  };\n\n  let validationError;\n  if (\n    passwordInputHasErrorOld ||\n    passwordInputHasError ||\n    passwordInputHasErrorRepeat\n  ) {\n    validationError = true;\n  }\n\n  let formIsValid = false;\n  if (enteredPasswordIsValid && enteredPassword === enteredPasswordRepeat) {\n    formIsValid = true;\n  }\n\n  // ПРИ РЕНДЕРЕ МОДАЛКИ ЗАПУСКАЕТСЯ ФУНКЦИЯ, КОТОРАЯ ЗАПРАШИВАЕТ ИЗ БД ТЕКУЩИЙ ПАРОЛЬ ПОЛЬЗОВАТЕЛЯ\n  // И СОХРАНЯЕТ ЕГО В ПЕРЕМЕННОЙ\n  // ЭТА ПЕРЕМЕННАЯ СРАВНИВАЕТСЯ С enteredPasswordOld И РЕЗУЛЬТАТ ЭТОГО СРАВНЕНИЯ СОХРАНЯЕТСЯ В ДРУГОЙ ПЕРЕМЕННОЙ\n  // КОТОРАЯ В СВОЮ ОЧЕРЕДЬ ИСПОЛЬЗУЕТСЯ ПРИ ВАЛИДАЦИИ formIsValid\n\n  const submitHandler = (event) => {\n    event.preventDefault();\n\n    const sendRequest = async () => {\n      const response = await fetch(\"api/v1/edit_password\", {\n        method: \"PUT\",\n        body: JSON.stringify({\n          current_password: enteredPasswordOld,\n          password: enteredPassword,\n        }),\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n          \"Content-Type\": \"application/json\",\n        },\n      });\n\n      document.activeElement.blur();\n      resetPasswordInputOld();\n      resetPasswordInput();\n      resetPasswordInputRepeat();\n\n      if (!response.ok) {\n        throw new Error(\"Something went wrong. Please try again.\");\n      }\n\n      console.log(enteredPassword);\n      dispatch(modalActions.closeModal());\n      dispatch(\n        notificationActions.showNotification({\n          status: \"success\",\n          message: `Your password has been changed successfully! `,\n        })\n      );\n      setTimeout(() => {\n        dispatch(notificationActions.hideNotification());\n        // dispatch(authActions.logOut());\n      }, 2500);\n      setTimeout(() => {\n        dispatch(notificationActions.resetNotification());\n      }, 4000);\n    };\n\n    sendRequest().catch((err) => {\n      dispatch(\n        notificationActions.showNotification({\n          status: \"error\",\n          message: err.message,\n        })\n      );\n      setTimeout(() => {\n        dispatch(notificationActions.hideNotification());\n      }, 2500);\n      setTimeout(() => {\n        dispatch(notificationActions.resetNotification());\n      }, 4000);\n    });\n  };\n\n  return (\n    <Modal modalType=\"changePassword\" reset={resetForm} show={props.show}>\n      <div className={classes.container}>\n        <span className={classes.title}>Change password</span>\n        <form onSubmit={submitHandler}>\n          <div className=\"inputsContainer\">\n            <PasswordInput\n              enteredPassword={enteredPasswordOld}\n              passwordInputHasError={passwordInputHasErrorOld}\n              enteredPasswordIsValid={enteredPasswordIsValidOld}\n              passwordChangedHandler={passwordChangedHandlerOld}\n              passwordBlurHandler={passwordBlurHandlerOld}\n              resetPasswordInput={resetPasswordInputOld}\n              placeholder=\"Old password\"\n            />\n            <PasswordInput\n              enteredPassword={enteredPassword}\n              passwordInputHasError={passwordInputHasError}\n              enteredPasswordIsValid={enteredPasswordIsValid}\n              passwordChangedHandler={passwordChangedHandler}\n              passwordBlurHandler={passwordBlurHandler}\n              resetPasswordInput={resetPasswordInput}\n              placeholder=\"New password\"\n            />\n            <PasswordInput\n              enteredPassword={enteredPasswordRepeat}\n              passwordInputHasError={passwordInputHasErrorRepeat}\n              enteredPasswordIsValid={enteredPasswordIsValidRepeat}\n              passwordChangedHandler={passwordChangedHandlerRepeat}\n              passwordBlurHandler={passwordBlurHandlerRepeat}\n              resetPasswordInput={resetPasswordInputRepeat}\n              placeholder=\"New password\"\n            />\n          </div>\n          {validationError && (\n            <span className={classes.errorText}>\n              Password can't be less then 6 symbols.\n            </span>\n          )}\n          <MainButton title=\"Confirm\" type=\"submit\" disabled={!formIsValid} />\n        </form>\n      </div>\n    </Modal>\n  );\n};\n\nexport default ChangePasswordModal;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}